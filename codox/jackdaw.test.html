<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jackdaw.test documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jackdaw</span> <span class="project-version">0.6.1-gh-pages-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="test-machine.html"><div class="inner"><span>The Test Machine</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jackdaw</span></div></div></li><li class="depth-2 branch"><a href="jackdaw.admin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>admin</span></div></a></li><li class="depth-2"><a href="jackdaw.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.client.log.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>log</span></div></a></li><li class="depth-3"><a href="jackdaw.client.partitioning.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>partitioning</span></div></a></li><li class="depth-2 branch"><a href="jackdaw.data.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>data</span></div></a></li><li class="depth-2"><a href="jackdaw.serdes.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>serdes</span></div></a></li><li class="depth-3"><a href="jackdaw.serdes.avro.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>avro</span></div></a></li><li class="depth-4 branch"><a href="jackdaw.serdes.avro.confluent.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>confluent</span></div></a></li><li class="depth-4"><a href="jackdaw.serdes.avro.schema-registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema-registry</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.serdes.edn.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>edn</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.serdes.fn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fn</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.serdes.fn-impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fn-impl</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.serdes.json.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>json</span></div></a></li><li class="depth-3"><a href="jackdaw.serdes.resolver.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>resolver</span></div></a></li><li class="depth-2 branch"><a href="jackdaw.specs.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2"><a href="jackdaw.streams.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>streams</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.configurable.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>configurable</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.configured.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>configured</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.extras.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>extras</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.interop.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interop</span></div></a></li><li class="depth-3"><a href="jackdaw.streams.lambdas.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lambdas</span></div></a></li><li class="depth-4"><a href="jackdaw.streams.lambdas.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.mock.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>mock</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.protocols.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocols</span></div></a></li><li class="depth-3"><a href="jackdaw.streams.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2 current"><a href="jackdaw.test.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-3"><a href="jackdaw.test.commands.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>commands</span></div></a></li><li class="depth-4 branch"><a href="jackdaw.test.commands.base.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>base</span></div></a></li><li class="depth-4 branch"><a href="jackdaw.test.commands.watch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>watch</span></div></a></li><li class="depth-4"><a href="jackdaw.test.commands.write.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>write</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.test.fixtures.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>fixtures</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.test.journal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>journal</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.test.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.test.serde.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>serde</span></div></a></li><li class="depth-3"><a href="jackdaw.test.transports.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transports</span></div></a></li><li class="depth-4 branch"><a href="jackdaw.test.transports.identity.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>identity</span></div></a></li><li class="depth-4 branch"><a href="jackdaw.test.transports.kafka.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>kafka</span></div></a></li><li class="depth-4 branch"><a href="jackdaw.test.transports.mock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mock</span></div></a></li><li class="depth-4"><a href="jackdaw.test.transports.rest-proxy.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rest-proxy</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jackdaw.test.html#var-.2Bdefault-executor.2B"><div class="inner"><span>+default-executor+</span></div></a></li><li class="depth-1"><a href="jackdaw.test.html#var-identity-transport"><div class="inner"><span>identity-transport</span></div></a></li><li class="depth-1"><a href="jackdaw.test.html#var-kafka-transport"><div class="inner"><span>kafka-transport</span></div></a></li><li class="depth-1"><a href="jackdaw.test.html#var-mock-transport"><div class="inner"><span>mock-transport</span></div></a></li><li class="depth-1"><a href="jackdaw.test.html#var-rest-proxy-transport"><div class="inner"><span>rest-proxy-transport</span></div></a></li><li class="depth-1"><a href="jackdaw.test.html#var-run-test"><div class="inner"><span>run-test</span></div></a></li><li class="depth-1"><a href="jackdaw.test.html#var-test-machine"><div class="inner"><span>test-machine</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jackdaw.test</h1><div class="doc"><pre class="plaintext">A test-machine executes sequences of test commands

Test machines can be constructed to operate against a variety of targets. For
example:

  - a local development kafka cluster
  - a mock topology processor
  - a cluster shared with other users

In each of these cases, as a test-author we typically want to do the same type
of thing. Inject a bunch of events into the system, wait until the system under
test has finished processing, see what comes out the other end, and check that
looks good.

But the mechanism by which data is injected and observed is different in each
case. The test-machine exists so that the author doesn't care. The exact same
test (or scenario) can be executed against a mock topology processor, a kafka
cluster running on localhost, or (via smokin or the rest-proxy) a remote
kafka cluster shared with other users.</pre></div><div class="public anchor" id="var-.2Bdefault-executor.2B"><h3>+default-executor+</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.6.1-gh-pages-SNAPSHOT/src/jackdaw/test.clj#L61">view source</a></div></div><div class="public anchor" id="var-identity-transport"><h3>identity-transport</h3><div class="usage"><code>(identity-transport _config _topics)</code></div><div class="doc"><pre class="plaintext">The identity transport simply injects input events directly into
the journal.

Like all transports, this has consumer and producer keys containing
processes that pick up test-commands added by `run-test`. However, this
transport simply echo's any write commands to the journal rather than
performing the write against another system.

Primarily used internally for test purposes but may also be useful
for testing your watch functions. The parameters are ignored and
exist only for compatibility with other transports.</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.6.1-gh-pages-SNAPSHOT/src/jackdaw/test.clj#L138">view source</a></div></div><div class="public anchor" id="var-kafka-transport"><h3>kafka-transport</h3><div class="usage"><code>(kafka-transport config topics)</code></div><div class="doc"><pre class="plaintext">The kafka transport injects input events by sending them via a
KafkaProducer with direct access to the kafka cluster. Likewise it
gathers output by polling a KafkaConsumer subscribed to the listed
topics and adding the results to the journal.

The `config` is shared by the consumer and producer processes and
used to construct the underlying KafkaProducer and KafkaConsumer
respectively

The `topics` parameter represents the "topics of interest" for
this transport. It should be a {"string" topic-metadata} map
which tells the producer how to serialize any write commands and
tells the consumer how to deserialize output messages before
adding them to the journal.</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.6.1-gh-pages-SNAPSHOT/src/jackdaw/test.clj#L153">view source</a></div></div><div class="public anchor" id="var-mock-transport"><h3>mock-transport</h3><div class="usage"><code>(mock-transport config topics)</code></div><div class="doc"><pre class="plaintext">The mock transport injects input events by submitting them to a
TopologyTestDriver. Likewise it gathers output by polling the
test driver's `.readOutput` method.

The `topics` parameter has the same semantics as in the
kafka-transport</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.6.1-gh-pages-SNAPSHOT/src/jackdaw/test.clj#L173">view source</a></div></div><div class="public anchor" id="var-rest-proxy-transport"><h3>rest-proxy-transport</h3><div class="usage"><code>(rest-proxy-transport config topics)</code></div><div class="doc"><pre class="plaintext">The rest-proxy transport injects input events by submitting them
to a remote kafka cluster via the confluent REST API. Likewise it
gathers output by polling the /records endpoint of the confluent
REST API.

If avro topics are involved, the topics must also be configured
with access to the confluent schema registry. It should be noted
that both the schema registry and the rest-proxy services used
in this scenario must be backed by the same kafka cluster (or
at least mirror images of one another).

The `topics` paramter has the same semantics as in the kafka-transport</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.6.1-gh-pages-SNAPSHOT/src/jackdaw/test.clj#L185">view source</a></div></div><div class="public anchor" id="var-run-test"><h3>run-test</h3><div class="usage"><code>(run-test machine commands)</code></div><div class="doc"><pre class="plaintext">Runs a sequence of test commands against a test-machine and returns a
response map.

The response map includes

  `:results` A sequence of execution results. One for each command
             attempted

  `:journal` A snapshot of all kafka output read by the test consumer

The first parameter is a test-machine and the second is a list of
commands to execute. Remember to use `with-open` on the test-machine
to ensure that all resources are correcly torn down.</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.6.1-gh-pages-SNAPSHOT/src/jackdaw/test.clj#L107">view source</a></div></div><div class="public anchor" id="var-test-machine"><h3>test-machine</h3><div class="usage"><code>(test-machine transport)</code><code>(test-machine transport executor)</code></div><div class="doc"><pre class="plaintext">Returns a test-machine for use in conjunction with `run-test`.

The test-machine is just a map to which we attach various stateful
objects required during a typical test run involving an application
which reads/writes to kafka.

The first parameter is a `transport` which can be obtained by one of
the transport returning functions defined below. The transport
determines how exactly the test events will be injected into the system
under test.

The (optional) second parameter is an executor and if none is specified
the `+default-executor+` is used.</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.6.1-gh-pages-SNAPSHOT/src/jackdaw/test.clj#L77">view source</a></div></div></div></body></html>